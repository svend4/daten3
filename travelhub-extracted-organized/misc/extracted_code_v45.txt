datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  password      String
  avatar        String?
  provider      String?   @default("email") // email, google, facebook
  providerId    String?
  emailVerified Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  bookings      Booking[]
  favorites     Favorite[]
  priceAlerts   PriceAlert[]
  searchHistory SearchHistory[]
  
  @@map("users")
}

model Booking {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        String   // flight, hotel, car
  itemId      String
  itemData    Json     // Full booking details
  
  status      String   @default("pending") // pending, confirmed, cancelled
  totalPrice  Float
  currency    String   @default("USD")
  
  bookingDate DateTime @default(now())
  travelDate  DateTime
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@map("bookings")
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type      String   // flight, hotel, destination
  itemId    String
  itemData  Json
  
  createdAt DateTime @default(now())
  
  @@unique([userId, type, itemId])
  @@index([userId])
  @@map("favorites")
}

model PriceAlert {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type         String   // flight, hotel
  searchParams Json
  targetPrice  Float
  currentPrice Float?
  
  active       Boolean  @default(true)
  triggered    Boolean  @default(false)
  lastChecked  DateTime @default(now())
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([userId, active])
  @@map("price_alerts")
}

model SearchHistory {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type         String   // flight, hotel, car
  searchParams Json
  resultsCount Int
  
  createdAt    DateTime @default(now())
  
  @@index([userId, createdAt])
  @@map("search_history")
}
