═══════════════════════════════════════════════════════════
🚀 ТЕСТ CORS - РАБОТАЕТ НЕМЕДЛЕННО (БЕЗ ОЖИДАНИЯ)
═══════════════════════════════════════════════════════════

📍 ШАГ 1: Откройте ваш фронтенд
──────────────────────────────────────────────────────────
https://daten3.onrender.com


📍 ШАГ 2: Откройте консоль браузера
──────────────────────────────────────────────────────────
Нажмите F12 → вкладка "Console" (Консоль)


📍 ШАГ 3: Скопируйте и вставьте этот код целиком
──────────────────────────────────────────────────────────

console.clear();
console.log('%c════════════════════════════════════════', 'color: #667eea; font-weight: bold');
console.log('%c🧪 ТЕСТ CORS - Frontend → Backend', 'color: #667eea; font-size: 16px; font-weight: bold');
console.log('%c════════════════════════════════════════\n', 'color: #667eea; font-weight: bold');

const BACKEND = 'https://daten3-1.onrender.com';
const FRONTEND = 'https://daten3.onrender.com';

console.log('Frontend:', FRONTEND);
console.log('Backend:', BACKEND);
console.log('\n');

let testsPassed = 0;
let testsTotal = 3;

// TEST 1: Health Check
console.log('%c▶ ТЕСТ 1: Health Check', 'color: #2196F3; font-weight: bold');
fetch(`${BACKEND}/api/health`, { credentials: 'include' })
  .then(r => {
    if (r.ok) {
      console.log('%c  ✅ ПРОЙДЕН', 'color: #4CAF50; font-weight: bold');
      console.log('  Status:', r.status);
      testsPassed++;
      return r.json();
    } else {
      console.log('%c  ❌ ПРОВАЛЕН', 'color: #f44336; font-weight: bold');
      console.log('  Status:', r.status);
    }
  })
  .then(data => {
    if (data) console.log('  Response:', data);
    console.log('\n');

    // TEST 2: CORS Headers
    console.log('%c▶ ТЕСТ 2: CORS Headers', 'color: #2196F3; font-weight: bold');
    return fetch(`${BACKEND}/api/health`, { credentials: 'include' });
  })
  .then(r => {
    const origin = r.headers.get('access-control-allow-origin');
    const creds = r.headers.get('access-control-allow-credentials');

    console.log('  CORS Origin:', origin);
    console.log('  CORS Credentials:', creds);

    if (origin === FRONTEND && creds === 'true') {
      console.log('%c  ✅ ПРОЙДЕН', 'color: #4CAF50; font-weight: bold');
      testsPassed++;
    } else {
      console.log('%c  ❌ ПРОВАЛЕН', 'color: #f44336; font-weight: bold');
      if (origin !== FRONTEND) {
        console.log('%c  ✗ Origin не совпадает!', 'color: #ff9800');
        console.log('    Ожидается:', FRONTEND);
        console.log('    Получено:', origin);
      }
    }
    console.log('\n');

    // TEST 3: CSRF Token
    console.log('%c▶ ТЕСТ 3: CSRF Token', 'color: #2196F3; font-weight: bold');
    return fetch(`${BACKEND}/api/csrf-token`, { credentials: 'include' });
  })
  .then(r => r.json())
  .then(data => {
    if (data.csrfToken) {
      console.log('%c  ✅ ПРОЙДЕН', 'color: #4CAF50; font-weight: bold');
      console.log('  Token:', data.csrfToken.substring(0, 20) + '...');
      testsPassed++;
    } else {
      console.log('%c  ❌ ПРОВАЛЕН', 'color: #f44336; font-weight: bold');
      console.log('  Токен не получен');
    }
    console.log('\n');

    // RESULTS
    console.log('%c════════════════════════════════════════', 'color: #667eea; font-weight: bold');
    console.log(`%cРезультат: ${testsPassed}/${testsTotal} тестов пройдено`, 'font-size: 14px; font-weight: bold');
    console.log('%c════════════════════════════════════════', 'color: #667eea; font-weight: bold');

    if (testsPassed === testsTotal) {
      console.log('%c\n🎉 ВСЁ РАБОТАЕТ!', 'color: #4CAF50; font-size: 20px; font-weight: bold');
      console.log('%cFrontend успешно подключается к Backend!', 'color: #4CAF50; font-size: 14px');
      console.log('%cCORS настроен правильно!', 'color: #4CAF50; font-size: 14px');
      console.log('%cМожете использовать приложение!\n', 'color: #4CAF50; font-size: 14px');
    } else {
      console.log('%c\n❌ Обнаружены проблемы', 'color: #f44336; font-size: 20px; font-weight: bold');
      console.log('\n%c📋 Что проверить:', 'color: #ff9800; font-weight: bold');
      console.log('1. FRONTEND_URL установлен в Render Dashboard?');
      console.log('   Key: FRONTEND_URL');
      console.log('   Value: https://daten3.onrender.com');
      console.log('2. Backend передеплоен после добавления переменной?');
      console.log('3. Backend не спит? (откройте https://daten3-1.onrender.com/api/health)\n');
    }
  })
  .catch(err => {
    console.log('%c\n❌ КРИТИЧЕСКАЯ ОШИБКА', 'color: #f44336; font-size: 20px; font-weight: bold');
    console.log('Ошибка:', err.message);
    console.log('\nВозможные причины:');
    console.log('• Backend не запущен или спит');
    console.log('• CORS заблокирован');
    console.log('• Нет сетевого подключения\n');
  });


──────────────────────────────────────────────────────────
📍 ШАГ 4: Нажмите Enter
──────────────────────────────────────────────────────────


═══════════════════════════════════════════════════════════
✅ ЧТО ВЫ УВИДИТЕ:
═══════════════════════════════════════════════════════════

Если всё работает:
    ✅ ТЕСТ 1: ПРОЙДЕН
    ✅ ТЕСТ 2: ПРОЙДЕН
    ✅ ТЕСТ 3: ПРОЙДЕН

    Результат: 3/3 тестов пройдено
    🎉 ВСЁ РАБОТАЕТ!

Если не работает:
    ❌ Покажет какой тест провалился
    📋 Покажет что нужно исправить


═══════════════════════════════════════════════════════════
⚡ ПРЕИМУЩЕСТВА ЭТОГО МЕТОДА:
═══════════════════════════════════════════════════════════

✅ Работает ПРЯМО СЕЙЧАС (не нужно ждать деплой)
✅ Правильный Origin (запускается с https://daten3.onrender.com)
✅ Тестирует реальный production backend
✅ Показывает точные результаты
✅ Не требует дополнительных файлов


═══════════════════════════════════════════════════════════
📌 ВАЖНО:
═══════════════════════════════════════════════════════════

• Откройте именно https://daten3.onrender.com (НЕ localhost)
• Вставьте весь код целиком
• Дождитесь результатов (5-10 секунд)
• Скопируйте и пришлите результат


═══════════════════════════════════════════════════════════
